#
# Datatypes used in fields of the GFA2 format
#

# Tags are defined in a separate file

datatypes:

  gfa2_placeholder: {constant: {"*": null}}
  gfa2_opt_integer: {one_of: [gfa2_placeholder, integer]}

  # alignments:
  gfa2_cigar_operation: {composed_of: [length: unsigned_integer,
                                  code: {regex: "[MDIP]"}]}
  gfa2_cigar:  {list_of: gfa2_cigar_operation, sep: "", minlength: 1}
  gfa2_cigars: {list_of: gfa2_cigar, sep: ",", minlength: 2}
  gfa2_trace:  {list_of: unsigned_integer, sep: ",", minlength: 1}
  gfa2_alignment: {one_of: [gfa2_placeholder, gfa2_cigars, gfa2_trace]}

  # identifiers and references:
  gfa2_id: {regex: "[!-)+-~][!-~]*"}  # different from original
  gfa2_opt_id: {one_of: [gfa2_placeholder, gfa2_id]}
  gfa2_ref: {composed_of: [id: gfa2_id, orientation: {regex: "[+-]"}]}
  gfa2_id_list: {list_of: gfa2_id, sep: " ", minlength: 1}
  gfa2_ref_list: {list_of: gfa2_ref, sep: " ", minlength: 1}

  # sequence
  gfa2_sequence: {one_of: [gfa2_placeholder, regex: "[!-~]+"]}

  # overlap positions
  gfa2_position: {composed_of: [value: unsigned_integer,
                                final: {constant: {"$": true}, empty: false}]}

#
# Testdata was created using generate_tests and
# further examples were added manually
#

testdata:
  gfa2_opt_integer:
    valid: {"-9223372036854775808":-9223372036854775808, "-1":-1, "1":1,
            "9223372036854775807":9223372036854775807, "*":null, "0":0}
    invalid:
      encoded: ["*c", "", "a", "[]", "{}", "1.0"]
      decoded: [true, 1.0, [], {}, "", "A"]
  gfa2_ref_list:
    valid:
      "ii21V- ii21V-": [{"id":"ii21V","orientation":"-"},{"id":"ii21V","orientation":"-"}]
      "ii21V-": [{"id":"ii21V","orientation":"-"}]
    invalid:
      encoded: [""]
      decoded: [[], ""]
  gfa2_ref:
    valid: {"O&+M-":{"id":"O&+M","orientation":"-"}}
    invalid:
      encoded: [""]
      decoded: [""]
  gfa2_id:
    valid: ["IpPj\\", "9E", "WE~", "{:eA~", "p", "!]z", "u", "5:", "hZ", "+"]
    invalid:
      encoded: [""]
      decoded: [""]
  gfa2_id_list:
    valid:
      "l.+!": ["l.+!"]
      "l.+! _ {Lbl h %8 m1Tb) v]x-Q FRD 7 kn": ["l.+!","_","{Lbl","h","%8","m1Tb)","v]x-Q","FRD","7","kn"]
    invalid:
      encoded: [""]
      decoded: [[], ""]
  gfa2_cigars:
    valid:
      "1D1D,1D": [[{"length":1,"code":"D"},{"length":1,"code":"D"}],[{"length":1,"code":"D"}]]
    invalid:
      encoded: ["1D1D", ""]
      decoded: [[], [[{"length":1,"code":"D"},{"length":1,"code":"D"}]], ""]
  gfa2_position:
    valid: {"1$":{"value":1,"final":true}}
    invalid:
      encoded: [""]
      decoded: [""]
  gfa2_trace:
    valid: {"1":[1], "1,9223372036854775807,0":[1,9223372036854775807,0]}
    invalid:
      encoded: [""]
      decoded: [[], ""]
  gfa2_opt_id:
    valid: {"PBx!":"PBx!", "P5bix":"P5bix", "%q~u":"%q~u", "5[o?":"5[o?",
            "TlM":"TlM", "E2Lz":"E2Lz", "p":"p", "*":null, "[do":"[do",
            "Xif":"Xif", "dur":"dur"}
    invalid:
      encoded: ["*c", ""]
      decoded: [true, 1, 1.0, [], {}, ""]
  gfa2_sequence:
    valid: {"tSz\\S":"tSz\\S", "7b)b@":"7b)b@", "\"uyEu":"\"uyEu",
            "{-TN":"{-TN", "]":"]", "*":null, "/;WYj":"/;WYj", "Rj":"Rj",
            "^N]T":"^N]T", "O":"O", "V":"V"}
    invalid:
      encoded: [""]
      decoded: [true, 1, 1.0, [], {}, ""]
  gfa2_alignment:
    valid:
      "1": [1]
      "*": null
      "1D1D,1D": [[{"length":1,"code":"D"},{"length":1,"code":"D"}],[{"length":1,"code":"D"}]]
      "1,9223372036854775807,0": [1,9223372036854775807,0]
    invalid:
      encoded: ["*c", "", "1D1D"]
      decoded: [true, 1, 1.0, [], {}, "",
                [[{"length":1,"code":"D"},{"length":1,"code":"D"}]]]
  gfa2_cigar_operation:
    valid: {"1D":{"length":1,"code":"D"}}
    invalid:
      encoded: [""]
      decoded: [""]
  gfa2_cigar:
    valid: {"1P":[{"length":1,"code":"P"}],
            "1P1P":[{"length":1,"code":"P"},{"length":1,"code":"P"}]}
    invalid:
      encoded: [""]
      decoded: [[], ""]
  gfa2_placeholder:
    valid: {"*":null}
    invalid:
      encoded: ["*c", ""]
      decoded: [true, 1, 1.0, [], {}, ""]
